# 水模图像功能说明

## 概述

MedImager 现在支持生成标准的水等效体模图像，用于CT图像质量测试和算法验证。

## 水模结构

生成的水模图像包含以下结构：

### 主体结构
- **外圈**: PMMA材料外壳 (~120 HU)
- **内部**: 水填充 (0 HU)  
- **背景**: 空气 (-1000 HU)

### 测试插件
水模内部包含4个不同密度的测试插件：

1. **骨等效材料** (左上角)
   - HU值: ~400 HU
   - 位置: 距中心(-80, -80)像素
   - 半径: 20像素

2. **脂肪等效材料** (右上角)  
   - HU值: ~-100 HU
   - 位置: 距中心(+80, -80)像素
   - 半径: 20像素

3. **软组织等效材料** (下方)
   - HU值: ~40 HU  
   - 位置: 距中心(0, +80)像素
   - 半径: 20像素

## 技术参数

### 图像参数
- **图像尺寸**: 512×512像素
- **像素类型**: 32位浮点数
- **HU值范围**: -1000 到 +400
- **噪声**: 标准差5 HU的高斯噪声

### DICOM元数据
- **模态**: CT
- **研究描述**: Water Phantom QA
- **序列描述**: Water Equivalent Phantom
- **患者名称**: PHANTOM^WATER
- **患者ID**: WP001
- **层厚**: 5.0mm
- **像素间距**: 0.5×0.5mm
- **管电压**: 120kVp
- **管电流时间积**: 200mAs

## 窗宽窗位设置

### 默认设置
- **窗宽**: 100 HU
- **窗位**: 0 HU

这个设置优化用于观察水模中的不同密度材料，提供良好的对比度。

### 其他常用窗口
- **软组织窗**: 400/40 HU
- **骨窗**: 1500/300 HU  
- **肺窗**: 2000/-600 HU

## 使用方法

### 通过菜单生成
1. 启动MedImager应用程序
2. 点击菜单 **文件** → **生成水模图像**
3. 或使用快捷键 `Ctrl+T`

### 通过代码生成
```python
from medimager.core.image_data_model import ImageDataModel

# 创建数据模型
model = ImageDataModel()

# 生成水模图像数据
phantom_data = generate_water_phantom()  # 自定义函数

# 加载到模型
metadata = {
    'Modality': 'CT',
    'StudyDescription': 'Water Phantom QA',
    'SeriesDescription': 'Water Equivalent Phantom'
}

success = model.load_single_image(phantom_data, metadata)
if success:
    model.set_window(100, 0)  # 设置水模窗宽窗位
```

## 应用场景

### 质量保证测试
- **HU值准确性**: 验证不同材料的HU值测量精度
- **均匀性测试**: 检查水区域的HU值均匀性
- **噪声测试**: 评估图像噪声水平

### 算法验证
- **窗宽窗位算法**: 测试窗宽窗位调整功能
- **ROI分析**: 验证感兴趣区域分析算法
- **测量工具**: 校验距离和面积测量功能

### 教学演示
- **CT成像原理**: 展示不同材料的CT值差异
- **图像处理**: 演示医学图像处理技术
- **软件功能**: 展示DICOM查看器的各项功能

## HU值参考

### 标准材料HU值
| 材料 | 典型HU值 | 水模中的值 |
|------|----------|------------|
| 空气 | -1000 | -1000 |
| 脂肪 | -100 到 -50 | -100 |
| 水 | 0 | 0 |
| 软组织 | 20 到 70 | 40 |
| PMMA | 100 到 140 | 120 |
| 骨 | 300 到 1000+ | 400 |

## 注意事项

1. **噪声影响**: 添加了5 HU标准差的噪声，实际测量值会有小幅波动
2. **边缘效应**: 不同材料边界处可能有部分容积效应
3. **精度限制**: 浮点数精度和取整可能影响精确的HU值
4. **仅用于测试**: 此水模为软件测试用途，不代表真实物理体模

## 扩展功能

### 自定义水模
可以通过修改代码来创建不同配置的水模：
- 调整插件位置和大小
- 添加更多测试材料
- 修改整体尺寸和形状

### 多切片序列
可以扩展为3D水模序列：
- 不同层面包含不同测试结构
- 模拟真实CT扫描序列
- 支持MPR重建测试

这个水模图像功能为MedImager提供了标准化的测试数据，有助于验证软件功能和进行质量保证测试。 